"use strict";var _express=_interopRequireDefault(require("express")),_expressFileupload=_interopRequireDefault(require("express-fileupload")),_mysql=_interopRequireDefault(require("mysql")),_cors=_interopRequireDefault(require("cors")),_path=_interopRequireDefault(require("path"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var app=(0,_express.default)(),db=_mysql.default.createConnection({host:"localhost",user:"root",password:"Nald@0627",database:"marketplace",insecureAuth:!0});app.use(_express.default.json()),app.use((0,_cors.default)()),app.use((0,_expressFileupload.default)()),app.use("/public",_express.default.static("public")),app.get("/",function(e,r){r.json("this is the backend")}),app.post("/login/buyer",function(e,s){var r=e.body,a=r.username,n=r.password;db.query("SELECT * FROM buyer WHERE username = ? AND password = ?",[a,n],function(e,r){return e?(console.error(e),s.status(500).json({message:"Internal Server Error",error:e})):0<r.length?s.status(200).json({message:"Buyer login successful"}):s.status(401).json({message:"Invalid credentials for buyer"})})}),app.post("/login/seller",function(e,s){var r=e.body,a=r.username,n=r.password;db.query("SELECT * FROM seller WHERE username = ? AND password = ?",[a,n],function(e,r){return e?(console.error(e),s.status(500).json({message:"Internal Server Error",error:e})):0<r.length?s.status(200).json({message:"Seller login successful"}):s.status(401).json({message:"Invalid credentials for seller"})})}),app.post("/signup",function(e,a){var n,t,r=e.body,o=r.username,u=r.password,i=r.name,s=r.userType;if(!o||!u||!i)return a.status(400).json({message:"Username, password, and name are required"});if("buyer"===s)n="buyer",t="name";else{if("seller"!==s)return a.status(400).json({message:"Invalid user type"});n="seller",t="name"}var c="SELECT * FROM ".concat(n," WHERE username = ?");db.query(c,[o],function(e,r){if(e)return console.error(e),a.status(500).json({message:"Internal Server Error",error:e});if(0<r.length)return a.status(409).json({message:"Username already exists"});var s="INSERT INTO ".concat(n," (`username`, `password`, `").concat(t,"`) VALUES (?, ?, ?)");db.query(s,[o,u,i],function(e,r){return e?(console.error(e),a.status(500).json({message:"Internal Server Error",error:e})):a.status(201).json({message:"User registered successfully"})})})}),app.get("/car",function(e,s){db.query("SELECT * FROM car",function(e,r){return e?s.json(e):s.json(r)})}),app.get("/upload/:filename",function(e,r){var s=e.params.filename;r.sendFile(_path.default.join(__dirname,"public","upload",s))}),app.get("/review",function(e,s){db.query("SELECT * FROM review",function(e,r){return e?s.json(e):s.json(r)})}),app.post("/car",function(e,s){var r=e.body,a=r.prod_name,n=r.prod_description,t=r.price,o=r.type,u=e.files.image;if(!u)return s.status(400).json({message:"No image provided"});var i="public/upload/".concat(u.name);u.mv(i,function(e){if(e)return console.error(e),s.status(500).json({message:"Error saving image"});var r=[a,n,t,o,i];db.query("INSERT INTO car (`prod_name`, `prod_description`, `price`, `type`, `image`) VALUES (?, ?, ?, ?, ?)",r,function(e,r){return e?(console.error(e),s.status(500).json({message:"Internal Server Error",error:e})):s.status(201).json({message:"Car added successfully"})})})}),app.delete("/car/:id",function(e,s){var r=e.params.id;db.query("DELETE FROM car WHERE id= ?",r,function(e,r){return e?(console.error(e),s.status(500).json({message:"Internal Server Error",error:e})):s.status(201).json({message:"Car Deleted"})})}),app.post("/review/car/:carid",function(e,s){var r=[e.params.carid,e.body.customername,e.body.title,e.body.content,e.body.rating,e.body.reviewdate];db.query("INSERT INTO review (`carid`, `customername`, `title`, `content`, `rating`, `reviewdate`) VALUES (?, ?, ?, ?, ?, ?)",r,function(e,r){return e?(console.error("Error inserting review:",e),s.status(500).json({message:"Internal Server Error",error:e})):s.status(201).json({message:"Review added successfully"})})}),app.put("/review/car/:carid",function(e,s){var r=[e.body.customername,e.body.title,e.body.content,e.body.rating,e.body.reviewdate,e.params.id];db.query("UPDATE review SET `customername`=?, `title`=?, `content`=?, `rating`=?, `reviewdate`=? WHERE reviewid=?",r,function(e,r){return e?(console.error(e),s.status(500).json({message:"Internal Server Error",error:e})):s.status(201).json({message:"Review updated successfully"})})}),app.put("/car/:id",function(e,s){var r,a=e.params.id,n=e.body,t=n.prod_name,o=n.prod_description,u=n.price,i=n.type,c=e.files.image;c&&(r="public/upload/".concat(c.name),c.mv(r,function(e){if(e)return console.error(e),s.status(500).json({message:"Error saving image"})}));var d="UPDATE car SET \n    prod_name = ?, \n    prod_description = ?, \n    ".concat(c?"image = ?,":""," \n    price = ?, \n    type = ? \n    WHERE id = ?"),p=[t,o,c?r:null,u,i,a];db.query(d,p,function(e,r){return e?(console.error(e),s.status(500).json({message:"Internal Server Error",error:e})):s.status(201).json({message:"Car Updated"})})}),app.get("/car/:id",function(e,s){var r=e.params.id;db.query("SELECT * FROM car WHERE id = ?",[r],function(e,r){return e?(console.error("Error executing query:",e),s.status(500).json({message:"Internal Server Error",error:e})):0<r.length?s.status(200).json(r[0]):s.status(404).json({message:"Car not found"})})}),app.get("/review/car/:carid",function(e,s){var r=e.params.carid;db.query("SELECT * FROM review WHERE carid = ?",[r],function(e,r){return e?(console.error(e),s.status(500).json({message:"Internal Server Error",error:e})):0<r.length?s.status(200).json(r):s.status(404).json({message:"No reviews found for this car"})})}),app.listen(8800,function(){console.log("connected to backend")});
//# sourceMappingURL=index.min.js.map
